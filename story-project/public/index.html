<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>分岐型物語 | 物語の選択</title>
    <!-- Tailwind CSSを読み込み -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts (Noto Sans JP & Noto Serif JP) を読み込み -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Noto+Serif+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            /* 背景画像を設定 */
            background-image: url('background-image.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        .font-serif-story {
            font-family: 'Noto Serif JP', serif;
        }
        .story-text {
            white-space: pre-wrap;
            word-break: break-all;
        }
        .blinking-cursor {
            animation: blink 1.5s step-end infinite;
        }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
        .clickable-area {
            cursor: pointer;
        }
        /* 本のカードのスタイル */
        .book-card {
            border-width: 4px;
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }
        .book-card:hover {
            transform: translateY(-10px) rotate(-2deg);
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.2), 0 8px 10px -6px rgb(0 0 0 / 0.2);
        }
        .book-card-disabled {
            opacity: 0.6;
            cursor: not-allowed;
            filter: grayscale(80%);
        }
        .book-card-disabled:hover {
            transform: none;
            box-shadow: none;
        }
    </style>
</head>
<body class="flex flex-col items-center justify-end min-h-screen p-4">

    <div id="choices-container" class="w-full max-w-4xl grid grid-cols-1 gap-4 mb-4" style="display: none;">
    </div>

    <div id="content-box" class="w-full max-w-4xl bg-amber-100 rounded-lg shadow-2xl p-6 transition-all duration-500 border-8 border-amber-900/80 mb-8">
        
        <!-- 初期設定画面 (名前入力など) -->
        <div id="setup-container">
            <div id="initial-prompt" class="relative clickable-area">
                <div class="flex flex-col items-center gap-4">
                    <div class="flex-grow">
                        <p id="narrator-text" class="text-center leading-relaxed story-text font-serif-story text-stone-800 text-lg font-semibold"></p>
                    </div>
                </div>
                <div id="narrator-continue-icon" class="absolute bottom-2 right-2 text-stone-600 blinking-cursor" style="display: none;">▼</div>
            </div>
            <div id="name-input-section" style="display: none;">
                <div class="mt-4">
                    <label for="player-name-input" class="block mb-2 text-lg font-semibold text-stone-800">あなたの名前</label>
                    <input type="text" id="player-name-input" class="bg-amber-50 border border-amber-800/50 text-stone-900 text-lg rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block w-full p-2.5" placeholder="例：たくや">
                </div>
                <button id="submit-name-button" class="w-full mt-4 bg-indigo-700 text-white font-semibold py-3 px-6 rounded-lg hover:bg-indigo-800 transition-colors duration-300 shadow-lg text-lg">名前を伝える</button>
            </div>

            <div id="confirmation-prompt" style="display: none;">
                <h1 class="text-2xl md:text-3xl font-bold mb-4 text-center text-stone-800 font-serif-story">承りました</h1>
                <p id="confirmation-text" class="mb-6 text-center leading-relaxed story-text font-serif-story text-stone-700 text-lg font-semibold"></p>
                <button id="start-button" class="w-full bg-green-700 text-white font-semibold py-3 px-6 rounded-lg hover:bg-green-800 transition-colors duration-300 shadow-lg text-lg">物語を選ぶ</button>
            </div>
        </div>

        <!-- 物語選択画面 -->
        <div id="story-selection-container" class="text-center" style="display: none;">
            <h2 class="text-2xl md:text-3xl font-bold mb-8 text-stone-800 font-serif-story">どの物語を紡ぎますか？</h2>
            <div class="flex flex-col md:flex-row justify-center items-center gap-8">
                <!-- Book 1: 仲直り -->
                <div id="story-reconciliation" class="book-card bg-amber-200 border-amber-800/50 p-6 rounded-lg shadow-lg w-64 h-80 flex flex-col justify-center items-center cursor-pointer">
                    <svg class="w-16 h-16 text-amber-900" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" />
                    </svg>
                    <h3 class="text-2xl font-bold font-serif-story text-stone-800 mt-4">仲直り</h3>
                    <p class="text-stone-600 mt-2 text-sm">親友とケンカした、<br>ある日の放課後の物語。</p>
                </div>
                <!-- Book 2: Coming Soon -->
                <div class="book-card book-card-disabled bg-gray-200 border-gray-400/50 p-6 rounded-lg shadow-lg w-64 h-80 flex flex-col justify-center items-center">
                    <svg class="w-16 h-16 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" />
                    </svg>
                    <h3 class="text-2xl font-bold font-serif-story text-gray-500 mt-4">Coming Soon</h3>
                    <p class="text-gray-400 mt-2 text-sm">次の物語を<br>お楽しみに。</p>
                </div>
            </div>
        </div>

        <!-- 物語本編 -->
        <div id="main-container" style="display: none;">
            <div id="story-container" class="relative clickable-area">
                <p id="story-text" class="text-xl leading-relaxed story-text text-stone-800 font-semibold"></p>
                <div id="story-continue-icon" class="absolute bottom-2 right-2 text-stone-600 blinking-cursor" style="display: none;">▼</div>
            </div>

            <div id="controls-container" class="mt-8 text-center space-y-4">
                 <button id="restart-button" class="bg-indigo-700 text-white font-semibold py-2 px-6 rounded-lg hover:bg-indigo-800 transition-colors duration-300" style="display: none;">最初からやり直す</button>
            </div>
        </div>
    </div>

    <script>
        // DOM要素を取得
        const contentBox = document.getElementById('content-box');
        const setupContainer = document.getElementById('setup-container');
        const storySelectionContainer = document.getElementById('story-selection-container');
        const mainContainer = document.getElementById('main-container');
        const initialPrompt = document.getElementById('initial-prompt');
        const narratorText = document.getElementById('narrator-text');
        const narratorContinueIcon = document.getElementById('narrator-continue-icon');
        const nameInputSection = document.getElementById('name-input-section');
        const confirmationPrompt = document.getElementById('confirmation-prompt');
        const playerNameInput = document.getElementById('player-name-input');
        const submitNameButton = document.getElementById('submit-name-button');
        const confirmationText = document.getElementById('confirmation-text');
        const startButton = document.getElementById('start-button');
        const storyReconciliationButton = document.getElementById('story-reconciliation');
        
        const storyContainer = document.getElementById('story-container');
        const storyTextElement = document.getElementById('story-text');
        const storyContinueIcon = document.getElementById('story-continue-icon');
        const choicesContainer = document.getElementById('choices-container');
        const restartButton = document.getElementById('restart-button');

        // =================================================================================
        // 物語のデータ
        // =================================================================================
        const narratorLines = [
            "ようこそおいでくださいました。\n新たなる物語の紡ぎ手…とお呼びすべきでしょうか。",
            "お待ちしておりました。\n私が紹介するのは、まだ誰も知らない物語です。",
            "貴方様がその一歩を踏み出すことで、\n止まっていた時間は動き出し、\n登場人物たちは息を吹き返すのでございます。",
            "さあ、物語の最初のページをめくる前に、\n貴方様の名前を、この私に教えてはいただけませんか？"
        ];
        
        const storyData = {
            '1': {
                text: [
                    '今日は最悪な一日だった。',
                    '朝からイライラしていて、教室でもゆうたと\n些細なことで言い合いになった。',
                    '最初は冗談のつもりだったけど、気づいたら\nお互いにカッとなって、大きな声を出してしまった。',
                    '「もういいよ！」\n「おまえなんか知ねーし！」',
                    '最後に吐いたその言葉が、\nずっと頭の中でぐるぐる回っている。',
                    '放課後の帰り道。\nランドセルがやけに重く感じる。足取りも重い。',
                    '明日、学校で顔を合わせるのがちょっと怖い。\nでも、謝るのもなんか悔しい。',
                    '自分が悪かったのかな？\nそれとも、ゆうたが言いすぎたのかな？\nそんな考えが頭をぐちゃぐちゃにする。',
                    '今日はどうしようかな？'
                ],
                choices: [
                    { text: 'A：近くの公園で少し休もう', nextScene: '2' },
                    { text: 'B：まっすぐ家に帰ろう', nextScene: '3' },
                    { text: 'C：思い切ってゆうたの家に行ってみよう', nextScene: '4' }
                ]
            },
            '2': {
                text: [
                    'ブランコの鎖が音を立てる。\n夕方の公園にはもう誰もいなくて、\n風が吹くたびに葉っぱが舞っている。',
                    '一人で座っていると、\n今日のことがどんどん頭に浮かんでくる。',
                    'ゆうたと初めてケンカしたのは今日かもしれない。\n今までは、どんなに意見が違っても、\nすぐに笑って終わってたのに。今日は違った。',
                    'なんで、あんなことを言ってしまったんだろう？\nゆうたも、あんなに怒ってたけど、\nほんとはどんな気持ちだったんだろう？',
                    'ポケットの中でスマホを握りしめたまま、\n何も打てずに画面を消す。連絡する勇気が出ない。',
                    'そんなとき、後ろから足音が聞こえた。\n見れば、同じクラスのまさとが通りかかった。',
                    '「{{playerName}}、なにしてんの、こんなとこで？」\nまさとが声をかけてくる。'
                ],
                choices: [
                    { text: 'A1：まさとにケンカのことを話してみる', nextScene: '5' },
                    { text: 'A2：ううん、なんでもないって言って一人で考え続ける', nextScene: '6' }
                ]
            },
            '3': {
                text: ['玄関のドアを開けると、お母さんの\n「おかえり」の声が聞こえた。',
                       'だけど、返事をする気になれなくて、\nそのまま靴を脱いで部屋に向かう。',
                       'ランドセルを置いて、ベッドに顔をうずめた。\n心の中がぐちゃぐちゃしている。ゆうたの顔が、\n何度も思い浮かぶ。',
                       '「なんであんなこと言っちゃったんだろう…」\nでも、「ゆうたも言いすぎたよな」とも思う。',
                       '気持ちが堂々巡りして、目が熱くなってきた。',
                       'そのとき、トントンとドアをノックする音。\n「{{playerName}}、なにかあったの？」とお母さんの声。\n少し考えて、ドアを開ける。'],
                choices: [ { text: 'B1：正直にお母さんに相談してみる', nextScene: '7' }, { text: 'B2：なんでもないと答えて、ひとりで抱え込む', nextScene: '6' }]
            },
            '4': {
                text: ['学校の帰り道をちょっとだけ遠回りして、\nゆうたの家の前に来た。',
                       '胸の奥がドキドキしてる。\n玄関のチャイムを押すかどうか、\n迷ったまましばらく立ち止まった。',
                       '\n――ピンポーン。\n',
                       '押してしまった。\nドアの向こうからゆうたのお母さんの声がして、\n少ししてからゆうたが出てきた。',
                       '玄関先に出てきたゆうたは、\nちょっと驚いた顔をして、でもすぐに目をそらした。',
                       '「……なに？」\n短くそう言われて、言葉に詰まる。'],
                choices: [ { text: 'C1：「話したかったんだ」と、正直に気持ちを伝える', nextScene: '8' }, { text: 'C2：「べつに……」と、つい素っ気なくしてしまう', nextScene: '9' }]
            },
            '5': {
                text: ['「なにしてんの？」と声をかけてきたのは、\nクラスメイトのまさと。',
                       '「{{playerName}}、ちょっとだけ…」と言いかけて、\n気づけば口が勝手に動いていた。',
                       '「ゆうたと、ケンカしちゃってさ」\nまさとは驚いた顔をしたあと、\nブランコのとなりに腰をおろした。',
                       '「マジか。でも、あいつも怒るとすぐ\nムキになるしなぁ。でも、{{playerName}}もわりとガンコだよな」',
                       '「……たしかに」\nちょっとだけ笑いがこみあげてくる。\n誰かに話したら、少しだけ気持ちが軽くなった。',
                       '「謝っとけば？たぶん、ゆうたも待ってんじゃね？」\nまさとの言葉が胸に刺さる。'],
                choices: [ { text: 'A1a：よし、ゆうたに謝りに行こう', nextScene: '10' }, { text: 'A1b：もう少しだけ自分の気持ちを整理してみたい', nextScene: '6' }]
            },
            '6': {
                text: ['誰にも言えないまま、夕方が夜に変わる。\nスマホの通知はゼロのまま。\n自分から動かないと、何も変わらないのかもしれない。',
                       '部屋の明かりをつけたまま、机に突っ伏して考える。',
                       '「あのとき、ゆうたがこう言ったから、ぼくも……」',
                       '言い訳ばっかりが頭の中に浮かんできて、\nどれも本当の気持ちとは違う気がしてきた。',
                       '気づけば、ノートのすみっこに\n「ごめん」と書いていた。',
                       'でも、どうすればいいのか――\nその一歩が、踏み出せない。'],
                choices: [ { text: 'A2a/B2a：このまま何もせず、ゆうたとの距離が開いてしまう', nextScene: 'H' }, { text: 'A2b/B2b：先生に相談してみようと思い立つ', nextScene: '11' }]
            },
            '7': {
                text: ['「今日さ、ゆうたとケンカしちゃって…」',
                       '少し迷ったあと、ポツリとこぼした言葉。\nお母さんは、黙ってうなずきながら聞いてくれた。',
                       '「そっか、{{playerName}}。\nゆうたくんは、仲のいいお友達だったよね」',
                       'お母さんの声は、いつもより少し優しくて、\nそれが逆に胸にしみた。',
                       '「ちゃんと話せば、きっとわかってくれると思うよ。\nでも、面と向かって話すのが難しいときは、\n手紙とかでも気持ちは伝わるよ」',
                       'お母さんが、紙とペンを差し出してきた。\n\n少しだけ迷ったけど、ゆっくりペンを持った。'],
                choices: [ { text: 'B1a：手紙を書いて、明日ゆうたに渡そうと決める', nextScene: '12' }, { text: 'B1b：やっぱり書くのをやめてしまう', nextScene: '6' }]
            },
            '8': { text: ['「話したかったんだ…」\nそれだけ言うのに、こんなに勇気がいるなんて思わなかった。', 'ゆうたはちょっと驚いた顔をして、それから俯いた。\n「……俺も、言いすぎたかも」', '静かにそうつぶやくゆうたに、胸のつかえが少し溶けていく。', 'そのまま、二人でしばらく玄関先に立ち尽くしていた。\n話す言葉は少なかったけど、心がすこし近づいた気がした。'], choices: [ { text: 'C1a：自然とお互い笑い合って仲直りできた', nextScene: 'A' }, { text: 'C1b：話せたけど、まだ少しモヤモヤが残った', nextScene: 'I' }] },
            '9': { text: ['「べつに…通りかかっただけ」\n気まずさからついそう言ってしまう。', 'ゆうたは一瞬ムッとしたような顔をして、\n「ふーん、じゃあ、なんか用ないんだ」\nと言って、ドアを閉めかけた。', 'ああ、しまった…。\n本当は謝りたかったのに、素直に言えなかった。','でも、閉まりかけたドアの向こうから、ゆうたの声がした。\n\n「……また、学校でな」'], choices: [ { text: 'C2a：それを聞いてほっとする', nextScene: 'G' }, { text: 'C2b：何も言えず、関係がぎくしゃくしたまま終わる', nextScene: 'H' }] },
            '10': { text: ['まさとの言葉に背中を押されて、ゆうたの家の前に立つ。\n今度こそ、自分の気持ちをちゃんと伝えよう。チャイムを押す手が震える。','玄関を開けたゆうたに、はっきり言う。\n「ごめん。あの時、言いすぎた。ほんとは後悔してる」','しばらく沈黙のあと、ゆうたが目を伏せながら言った。\n\n「……俺も、ごめん」\n二人は小さな声で笑い合った。'], choices: [ { text: 'そのまま素直に仲直りできた', nextScene: 'A' }, { text: 'ゆうたがまだ怒っていて許してくれなかった', nextScene: 'B' }] },
            '11': { text: ['次の日の朝、教室に入るのが少し怖かった。\nでも、勇気を出して先生に相談してみると、先生は驚かずに静かに話を聞いてくれた。','「気持ちを伝えたいと思ってる、\nそれだけでもすごく大事なことだよ」','先生は、さりげなくゆうたにも声をかけてくれたらしい。','昼休み、ゆうたがちょっとだけ目を合わせてきた。\n無言だったけど、昨日よりは気まずくなかった。'], choices: [ { text: '少しずつ話せるようになっていった', nextScene: 'J' }, { text: '結局、自分から話しかけられなかった', nextScene: 'H' }] },
            '12': { text: ['紙に「ごめんね」と書いたあと、言葉が止まる。\n何を書けばちゃんと伝わるだろう？\nたくさん考えて、何度も書き直して、ようやく完成した。','次の日、ゆうたの机にそっと手紙を入れた。','授業中、ゆうたがその手紙を読んでいるのが見えた気がする。放課後、後ろから声をかけられた。\n\n「……手紙、ありがとう」'], choices: [ { text: 'ゆうたが笑ってくれて仲直りできた', nextScene: 'C' }, { text: 'ゆうたが特に反応せず、手紙の返事もなかった', nextScene: 'D' }] },
            'A': { text: ['ふたりとも素直になって、お互いに謝ることができた。明日からまた、いつも通り一緒に笑えるね。'], choices: [] },
            'B': { text: ['謝ったけれど、ゆうたはまだ怒っていた。\nもう少し時間が必要かもしれない。'], choices: [] },
            'C': { text: ['手紙で気持ちを伝えられた。\n言葉にできない想いも、文字なら届くと信じてる。'], choices: [] },
            'D': { text: ['手紙は渡した。でも、それがゆうたに届いたかどうか、わからないまま終わった。'], choices: [] },
            'G': { text: ['ハッキリとは仲直りしなかったけど、また普通に話せるようになってきた。少しずつ距離を縮めていこう。'], choices: [] },
            'H': { text: ['結局、何もできないまま時間だけが過ぎていった。\n今はまだ、話しかける勇気がない。'], choices: [] },
            'I': { text: ['話すことはできたけど、まだ心のどこかで引っかってる。\nすっきりするには、もう少し時間が必要かも。'], choices: [] },
            'J': { text: ['自分だけじゃ難しかったけど、先生の力を借りて、\n少しずつ関係を取り戻せた。\n頼るって、大事なことなんだ。'], choices: [] }
        };

        // テキスト送りの状態を管理
        let currentSceneId = '1';
        let currentTextIndex = 0;
        let narratorTextIndex = 0;
        let isAnimating = false;

        function displayText(element, text, onComplete) {
            isAnimating = true;
            element.innerHTML = text;
            if (onComplete) {
                onComplete();
            }
            isAnimating = false;
        }

        // 案内人のセリフを表示する関数
        function showNarratorText() {
            if (narratorTextIndex < narratorLines.length) {
                narratorContinueIcon.style.display = 'none';
                displayText(narratorText, narratorLines[narratorTextIndex], () => {
                    narratorContinueIcon.style.display = 'block';
                });
            } else {
                narratorContinueIcon.style.display = 'none';
                nameInputSection.style.display = 'block';
            }
        }

        // 物語のシーンを描画する関数
        function renderScene(sceneId) {
            currentSceneId = sceneId;
            currentTextIndex = 0;
            const scene = storyData[sceneId];
            if (!scene) {
                console.error(`シーンID "${sceneId}" が見つかりません。`);
                return;
            }

            choicesContainer.innerHTML = ''; 
            choicesContainer.style.display = 'none';
            storyContinueIcon.style.display = 'none';

            showStoryText();
        }
        
        // 物語のテキストを表示する関数
        function showStoryText() {
            const scene = storyData[currentSceneId];
            if (currentTextIndex < scene.text.length) {
                const playerName = localStorage.getItem('playerName') || 'あなた';
                let textToShow = scene.text[currentTextIndex].replaceAll('{{playerName}}', playerName);
                
                storyContinueIcon.style.display = 'none';
                displayText(storyTextElement, textToShow, () => {
                    storyContinueIcon.style.display = 'block';
                });
            } else {
                storyContinueIcon.style.display = 'none';
                displayChoices();
            }
        }
        
        // 選択肢を表示する関数
        function displayChoices() {
            const scene = storyData[currentSceneId];
            const playerName = localStorage.getItem('playerName') || 'あなた';

            if (scene.choices && scene.choices.length > 0) {
                choicesContainer.style.display = 'grid';
                scene.choices.forEach(choice => {
                    const button = document.createElement('button');
                    let choiceText = choice.text.replaceAll('{{playerName}}', playerName);
                    button.className = "w-full bg-stone-900/70 hover:bg-stone-900/90 text-white font-bold py-3 px-4 rounded-lg transition-colors duration-300 border border-stone-500/50 text-lg";
                    button.textContent = choiceText;
                    button.onclick = () => handleChoice(choice.nextScene);
                    choicesContainer.appendChild(button);
                });
                restartButton.style.display = 'none';
            } else {
                choicesContainer.style.display = 'none';
                restartButton.style.display = 'inline-block';
            }
        }

        // 選択肢が選ばれたときの処理
        function handleChoice(nextSceneId) {
            renderScene(nextSceneId);
        }
        
        // イベントリスナーの設定
        document.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();

                if (getComputedStyle(setupContainer).display !== 'none') {
                    if (getComputedStyle(nameInputSection).display !== 'none') {
                        submitNameButton.click();
                    } else if (getComputedStyle(confirmationPrompt).display !== 'none') {
                        startButton.click();
                    } else if (getComputedStyle(initialPrompt).display !== 'none') {
                        initialPrompt.click();
                    }
                } else if (getComputedStyle(mainContainer).display !== 'none') {
                    storyContainer.click();
                }
            }
        });

        initialPrompt.addEventListener('click', () => {
            if (isAnimating) return;
            if (narratorTextIndex < narratorLines.length - 1) {
                narratorTextIndex++;
                showNarratorText();
            } else if (narratorTextIndex === narratorLines.length - 1) {
                narratorTextIndex++;
                showNarratorText();
            }
        });

        storyContainer.addEventListener('click', () => {
             if (isAnimating) return;
             const scene = storyData[currentSceneId];
             if(currentTextIndex < scene.text.length - 1) {
                 currentTextIndex++;
                 showStoryText();
             } else if (currentTextIndex === scene.text.length -1) {
                 currentTextIndex++;
                 showStoryText();
             }
        });

        submitNameButton.addEventListener('click', () => {
            const playerName = playerNameInput.value.trim() || 'あなた';
            localStorage.setItem('playerName', playerName);
            confirmationText.textContent = `「${playerName}」様、でございますね。確かに承りました。\nでは、物語の準備はすべて整いました。\nどうぞ、心ゆくまでお楽しみくださいませ。`;
            nameInputSection.style.display = 'none';
            initialPrompt.style.display = 'none';
            confirmationPrompt.style.display = 'block';
        });

        // 「物語を選ぶ」ボタンの処理
        startButton.addEventListener('click', () => {
            setupContainer.style.display = 'none';
            storySelectionContainer.style.display = 'block';
        });

        // 「仲直り」の物語を選択したときの処理
        storyReconciliationButton.addEventListener('click', () => {
            storySelectionContainer.style.display = 'none';
            mainContainer.style.display = 'block';
            renderScene('1');
        });

        restartButton.addEventListener('click', () => {
            mainContainer.style.display = 'none';
            storySelectionContainer.style.display = 'none';
            setupContainer.style.display = 'block';
            initialPrompt.style.display = 'block';
            confirmationPrompt.style.display = 'none';
            nameInputSection.style.display = 'none';
            narratorTextIndex = 0;
            localStorage.removeItem('playerName');
            playerNameInput.value = '';
            
            choicesContainer.style.display = 'none';
            showNarratorText();
        });

        // 初期表示
        playerNameInput.value = localStorage.getItem('playerName') || '';
        showNarratorText();

    </script>
</body>
</html>
